<html>
  <head>
    <title>HTML5 Webcam Test</title> 
    <style type="text/css">
      body{
        width: 100%;
        height: 100%;
      }
      #live_video{
        top: 0px;
        
        left: 0px;
      }
    </style>
  </head>
  <body>
  
    
<video autoplay></video>

<form action="page1-3.html">
<input type="file" accept="image/*" capture="camera" id="photo_field">
<input type="submit" value="GO">
</form>


<canvas style="display:none;"></canvas>

<script>
//<input type="file" capture="camera" accept="image/*" id="cameraInput" name="cameraInput">
  var video = document.querySelector('video');
  //video.width = window.innerWidth;
  //video.height = window.innerHeight;
  var canvas = document.querySelector('canvas');
  var body = document.querySelector('body');
  canvas.width = body.clientWidth;
  canvas.height = body.clientHeight;
  var ctx = canvas.getContext('2d');
  var localMediaStream = null;
  var errorCallback = function(e) {
    console.log('Reeeejected!', e);
  };
  var constraints = null;
  var videoSource = null;
  
  MediaStreamTrack.getSources(function(sourceInfos) {
  var audioSource = null;
  

  for (var i = 0; i != sourceInfos.length; ++i) {
    var sourceInfo = sourceInfos[i];
    if (sourceInfo.kind === 'audio') {
      console.log(sourceInfo.id, sourceInfo.label || 'microphone');

      audioSource = sourceInfo.id;
    } else if (sourceInfo.kind === 'video') {
      console.log(sourceInfo.id, sourceInfo.label || 'camera');

      videoSource = sourceInfo.id;
    } else {
      console.log('Some other kind of source: ', sourceInfo);
    }
  }
  
  constraints = {
    
    video: {
      optional: [{sourceId: videoSource}]
    }
  };
  navigator.webkitGetUserMedia(constraints, function(stream) {
    video.src = window.webkitURL.createObjectURL(stream);
    localMediaStream = stream;
  }, errorCallback);
  });

  function snapshot() { console.log('snapshot');
    if (localMediaStream) {
      ctx.drawImage(video, 0, 0);
      // "image/webp" works in Chrome.
      // Other browsers will fall back to image/png.
      //document.querySelector('img').src = canvas.toDataURL();
      
      localStorage["camera_photo"] = canvas.toDataURL();
      document.location.href = 'page1-3.html';
      
        var c = document.getElementById("content");
        var n = document.createElement("p");
        n.appendChild(document.createTextNode(canvas.toDataURL()));
        c.appendChild(n);
    }
  }

  video.addEventListener('click', snapshot, false);


  
</script>
    

  </body>
</html>

